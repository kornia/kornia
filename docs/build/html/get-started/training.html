<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YSCFZB2WDV"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-YSCFZB2WDV');
            
        </script>
    <link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Kornia AI Organization" href="governance.html" /><link rel="prev" title="Multi-Framework Support" href="multi-framework-support.html" />
        <link rel="canonical" href="https://kornia.readthedocs.io/get-started/training.html" />

    <link rel="shortcut icon" href="../_static/kornia_logo_favicon.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Training API (experimental) - Kornia</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/css/main.css?v=9b880210" />
    
    


<style>
  body {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  --color-sidebar-background: #3980F5;
  --color-sidebar-background-border: #3980F5;
  --color-sidebar-caption-text: white;
  --color-sidebar-link-text--top-level: white;
  --color-sidebar-link-text: white;
  --sidebar-caption-font-size: normal;
  --color-sidebar-item-background--hover:  #5dade2;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-sidebar-background: #1a1c1e;
  --color-sidebar-background-border: #1a1c1e;
  --color-sidebar-caption-text: white;
  --color-sidebar-link-text--top-level: white;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-sidebar-background: #1a1c1e;
  --color-sidebar-background-border: #1a1c1e;
  --color-sidebar-caption-text: white;
  --color-sidebar-link-text--top-level: white;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Kornia</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/img/kornia_logo_only_light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/img/kornia_logo_only_dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">GET STARTED</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">What is Kornia library ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="highlights.html">Highlighted Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://kornia.github.io/tutorials/">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi-framework-support.html">Multi-Framework Support</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Training API (experimental)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.luxonis.com/en/latest/pages/tutorials/creating-custom-nn-models/#kornia">OpenCV AI Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="governance.html">Kornia AI Organization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API REFERENCE</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../augmentation.html">kornia.augmentation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of kornia.augmentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../augmentation.auto.html">Automatic Augmentation Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../augmentation.base.html">Base Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../augmentation.container.html">Augmentation Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../augmentation.module.html">Image Augmentations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../color.html">kornia.color</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contrib.html">kornia.contrib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.html">kornia.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enhance.html">kornia.enhance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature.html">Local Features and Image Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">kornia.filters</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../geometry.html">kornia.geometry</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of kornia.geometry</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../geometry.bbox.html">kornia.geometry.bbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.boxes.html">kornia.geometry.boxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.keypoints.html">kornia.geometry.keypoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.calibration.html">kornia.geometry.calibration</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../geometry.camera.html">kornia.geometry.camera</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of kornia.geometry.camera</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometry.camera.pinhole.html">Pinhole Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry.camera.perspective.html">Perspective Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry.camera.stereo.html">Stereo Camera</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.conversions.html">kornia.geometry.conversions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.depth.html">kornia.geometry.depth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.epipolar.html">kornia.geometry.epipolar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.homography.html">kornia.geometry.homography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.liegroup.html">kornia.geometry.liegroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.liegroup.html#lie-algebra">lie algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.liegroup.html#lie-group-and-lie-algebra">lie group and lie algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.linalg.html">kornia.geometry.linalg</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.line.html">kornia.geometry.line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.quaternion.html">kornia.geometry.quaternion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.solvers.html">kornia.geometry.solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.subpix.html">kornia.geometry.subpix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.transform.html">kornia.geometry.transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.ransac.html">kornia.geometry.ransac</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../sensors.html">kornia.sensors</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of kornia.sensors</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../sensors.camera.html">kornia.sensors.camera</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../io.html">kornia.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../image.html">kornia.image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../losses.html">kornia.losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Models Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics.html">kornia.metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../morphology.html">kornia.morphology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nerf.html">kornia.nerf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx.html">ONNXSequential: Chain Multiple ONNX Models with Ease</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tracking.html">kornia.tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">kornia.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">kornia.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x.html">kornia.x</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KORNIA APPLICATIONS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../applications/intro.html">Computer Vision Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/visual_prompting.html">Visual Prompting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/face_detection.html">Face Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_augmentations.html">Image Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_classification.html">Image Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_matching.html">Image Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_stitching.html">Image Stitching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_registration.html">Image Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_denoising.html">Image Denoising</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/semantic_segmentation.html">Semantic segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/object_detection.html">Object detection</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KORNIA MODELS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../models/efficient_vit.html">EfficientViT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/rt_detr.html">Real-Time Detection Transformer (RT-DETR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/segment_anything.html">Segment Anything (SAM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/mobile_sam.html">Faster Segment Anything (MobileSAM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/yunet.html">YuNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/vit.html">Vision Transformer (ViT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/vit_mobile.html">MobileViT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/tiny_vit.html">TinyViT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/loftr.html">LoFTR (matching)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/defmo.html">DeFMO (video)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/hardnet.html">Hardnet (descriptor)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/affnet.html">Affnet (detection)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/sold2.html">SOLD2 (Line detection and matching)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/dexined.html">Dexined (edge detection)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SUPPORT</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/kornia/kornia/issues">Issue tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://join.slack.com/t/kornia/shared_invite/zt-csobk21g-2AQRi~X9Uu6PLMuUZdvfjA">Slack community</a></li>
<li class="toctree-l1"><a class="reference external" href="https://librecv.org">LibreCV community</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twitter.com/kornia_foss">Twitter @kornia_foss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/chinese.html">Kornia 社区</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.youtube.com/channel/UCI1SE1Ij2Fast5BSKxoa7Ag">Kornia Youtube</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.linkedin.com/company/kornia/">Kornia LinkedIn</a></li>
<li class="toctree-l1"><a class="reference external" href="https://kornia.org">Kornia AI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">COMMUNITY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/contribute.html">Contribute to Kornia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/faqs.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/bibliography.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/get-started/training.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="training-api-experimental">
<span id="training-api"></span><h1>Training API (experimental)<a class="headerlink" href="#training-api-experimental" title="Link to this heading">¶</a></h1>
<p>Kornia provides a Training API with the specific purpose to train and fine-tune the
supported deep learning algorithms within the library.</p>
<aside class="sidebar">
<p class="sidebar-title"><strong>Deep Alchemy</strong></p>
<blockquote>
<div><a class="reference internal image-reference" href="https://github.com/kornia/data/raw/main/pixie_alchemist.png"><img alt="https://github.com/kornia/data/raw/main/pixie_alchemist.png" class="align-center" src="https://github.com/kornia/data/raw/main/pixie_alchemist.png" style="width: 100%;" />
</a>
</div></blockquote>
<p>A seemingly magical process of transformation, creation, or combination of data to usable deep learning models.</p>
</aside>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In order to use our Training API you must: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">kornia[x]</span></code></p>
</div>
<section id="why-a-training-api">
<h2>Why a Training API ?<a class="headerlink" href="#why-a-training-api" title="Link to this heading">¶</a></h2>
<p>Kornia includes deep learning models that eventually need to be updated through fine-tuning.
Our aim is to have an API flexible enough to be used across our vision models and enable us to
override methods or dynamically pass callbacks to ease the process of debugging and experimentations.</p>
<div class="seealso admonition">
<p class="admonition-title"><strong>Disclaimer</strong></p>
<p>We do not pretend to be a general purpose training library but instead we allow Kornia users to
experiment with the training of our models.</p>
</div>
</section>
<section id="design-principles">
<h2>Design Principles<a class="headerlink" href="#design-principles" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><cite>kornia</cite> golden rule is to not have heavy dependencies.</p></li>
<li><p>Our models are simple enough so that a light training API can fulfill our needs.</p></li>
<li><p>Flexible and full control to the training/validation loops and customize the pipeline.</p></li>
<li><p>Decouple the model definition from the training pipeline.</p></li>
<li><p>Use plane PyTorch abstractions and recipes to write your own routines.</p></li>
<li><p>Implement <a class="reference external" href="https://github.com/huggingface/accelerate/">accelerate</a> library to scale the problem.</p></li>
</ul>
</section>
<section id="trainer-usage">
<h2>Trainer Usage<a class="headerlink" href="#trainer-usage" title="Link to this heading">¶</a></h2>
<p>The entry point to start training with Kornia is through the <a class="reference internal" href="../x.html#kornia.x.Trainer" title="kornia.x.Trainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trainer</span></code></a> class.</p>
<p>The main API is a self contained module that heavily relies on <a class="reference external" href="https://github.com/huggingface/accelerate/">accelerate</a>
to easily scale the training over multi-GPUs/TPU/fp16 <a class="reference external" href="https://github.com/huggingface/accelerate#supported-integrations/">(see more)</a>
by following standard PyTorch recipes. Our API expects to consume standard PyTorch components and you decide if <cite>kornia</cite> makes the magic
for you.</p>
<ol class="arabic simple">
<li><p>Define your model</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
  <span class="n">kornia</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">VisionTransformer</span><span class="p">(</span><span class="n">image_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span>
  <span class="n">kornia</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">ClassificationHead</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create the datasets and dataloaders for training and validation</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># datasets</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR10</span><span class="p">(</span>
  <span class="n">root</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">())</span>

<span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR10</span><span class="p">(</span>
  <span class="n">root</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">())</span>

<span class="c1"># dataloaders</span>
<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
  <span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">valid_daloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
  <span class="n">valid_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Create your loss function, optimizer and scheduler</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># loss function</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>

<span class="c1"># optimizer and scheduler</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">lr</span><span class="p">)</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">CosineAnnealingLR</span><span class="p">(</span>
  <span class="n">optimizer</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">num_epochs</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Create the Trainer and execute the training pipeline</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trainer</span> <span class="o">=</span> <span class="n">kornia</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span>
  <span class="n">model</span><span class="p">,</span> <span class="n">train_dataloader</span><span class="p">,</span> <span class="n">valid_daloader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>  <span class="c1"># execute your training !</span>
</pre></div>
</div>
</section>
<section id="customize-callbacks">
<h2>Customize [callbacks]<a class="headerlink" href="#customize-callbacks" title="Link to this heading">¶</a></h2>
<p>At this point you might think - <em>Is this API generic enough ?</em></p>
<blockquote>
<div><p>Of course not ! What is next ? Let’s have fun and <strong>customize</strong>.</p>
</div></blockquote>
<p>The <a class="reference internal" href="../x.html#kornia.x.Trainer" title="kornia.x.Trainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trainer</span></code></a> internals are clearly defined such in a way so that e.g you can
subclass and just override the <code class="xref py py-func docutils literal notranslate"><span class="pre">evaluate()</span></code> method and adjust
according to your needs. We provide predefined classes for generic problems such as
<a class="reference internal" href="../x.html#kornia.x.ImageClassifierTrainer" title="kornia.x.ImageClassifierTrainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageClassifierTrainer</span></code></a>, <a class="reference internal" href="../x.html#kornia.x.SemanticSegmentationTrainer" title="kornia.x.SemanticSegmentationTrainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">SemanticSegmentationTrainer</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>More trainers will come as soon as we include more models.</p>
</div>
<p>You can easily customize by creating your own class, or even through <code class="docutils literal notranslate"><span class="pre">callbacks</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">sample_id</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_dataloader</span><span class="p">):</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">sample</span>  <span class="c1"># this might change with new pytorch ataset structure</span>

    <span class="c1"># perform the preprocess and augmentations in batch</span>
    <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="c1"># Forward</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="c1"># Loss computation</span>
    <span class="n">val_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="c1"># measure accuracy and record loss</span>
    <span class="n">acc1</span><span class="p">,</span> <span class="n">acc5</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="n">target</span><span class="p">,</span> <span class="n">topk</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># create the trainer and pass the evaluate method as follows</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;evaluate&quot;</span><span class="p">,</span> <span class="n">my_evaluate</span><span class="p">})</span>
</pre></div>
</div>
<p><strong>Still not convinced ?</strong></p>
<blockquote>
<div><p>You can even override the whole <code class="xref py py-func docutils literal notranslate"><span class="pre">fit()</span></code>
method and implement your custom for loops and the trainer will setup for you using the Accelerator all
the data to the device and the rest of the story is just PyTorch :)</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># this is a custom pytorch training loop</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_epochs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_dataloader</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

      <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
      <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

      <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>  <span class="c1"># do whatever you want with validation</span>

<span class="c1"># create the trainer and pass the evaluate method as follows</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Trainer</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">my_fit</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following hooks are available to override: <code class="docutils literal notranslate"><span class="pre">preprocess</span></code>, <code class="docutils literal notranslate"><span class="pre">augmentations</span></code>, <code class="docutils literal notranslate"><span class="pre">evaluate</span></code>, <code class="docutils literal notranslate"><span class="pre">fit</span></code>,
<code class="docutils literal notranslate"><span class="pre">on_checkpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">on_epoch_end</span></code>, <code class="docutils literal notranslate"><span class="pre">on_before_model</span></code></p>
</div>
</section>
<section id="preprocess-and-augmentations">
<h2>Preprocess and augmentations<a class="headerlink" href="#preprocess-and-augmentations" title="Link to this heading">¶</a></h2>
<p>Taking a pre-trained model from an external source and assume that fine-tuning with your
data by just changing few things in your model is usually a bad assumption in practice.</p>
<p>Fine-tuning a model need a lot tricks which usually means designing a good augmentation
or preprocess strategy before you execute the training pipeline. For this reason, we enable
through callbacks to pass pointers to the <code class="docutils literal notranslate"><span class="pre">proprocess</span></code> and <code class="docutils literal notranslate"><span class="pre">augmentation</span></code> functions to make easy
the debugging and experimentation experience.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">float</span><span class="p">()</span> <span class="o">/</span> <span class="mf">255.</span>

<span class="n">augmentations</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
  <span class="n">K</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.75</span><span class="p">),</span>
  <span class="n">K</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">RandomVerticalFlip</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.75</span><span class="p">),</span>
  <span class="n">K</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">RandomAffine</span><span class="p">(</span><span class="n">degrees</span><span class="o">=</span><span class="mf">10.</span><span class="p">),</span>
  <span class="n">K</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">PatchSequential</span><span class="p">(</span>
        <span class="n">K</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">ColorJiggle</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
        <span class="n">grid_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># cifar-10 is 32x32 and vit is patch 16</span>
        <span class="n">patchwise_apply</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
  <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># create the trainer and pass the augmentation or preprocess</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">ImageClassifierTrainer</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
  <span class="n">callbacks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;preprocess&quot;</span><span class="p">,</span> <span class="n">preprocess</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">:</span> <span class="n">augmentations</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="callbacks-utilities">
<h2>Callbacks utilities<a class="headerlink" href="#callbacks-utilities" title="Link to this heading">¶</a></h2>
<p>We also provide utilities to save checkpoints of the model or early stop the training. You can use
as follows passing as <code class="docutils literal notranslate"><span class="pre">callbacks</span></code> the classes <a class="reference internal" href="../x.html#kornia.x.ModelCheckpoint" title="kornia.x.ModelCheckpoint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelCheckpoint</span></code></a> and
<a class="reference internal" href="../x.html#kornia.x.EarlyStopping" title="kornia.x.EarlyStopping"><code class="xref py py-class docutils literal notranslate"><span class="pre">EarlyStopping</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="c1"># stats = StatsTracker()</span>
  <span class="c1"># loss = nn.CrossEntropyLoss()</span>
  <span class="c1"># rest of your evaluation loop</span>
  <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
  <span class="n">val_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_loss</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
  <span class="n">stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">val_loss</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">batch_size</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>

    <span class="n">model_checkpoint</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span>
            <span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;./outputs&quot;</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">early_stop</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span>
            <span class="n">monitor</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">SemanticSegmentationTrainer</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;on_epoch_end&quot;</span><span class="p">:</span> <span class="n">early_stop</span><span class="p">,</span> <span class="s2">&quot;on_checkpoint&quot;</span><span class="p">,</span> <span class="n">model_checkpoint</span><span class="p">}</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’ll look something like this considering code above
| best_loss = inf</p>
<div class="line-block">
<div class="line">epoch 1:</div>
<div class="line">avg_loss = 1.0</div>
<div class="line">checkpoint = ./output/model_epoch=1_metricValue=1.0.pt</div>
</div>
<div class="line-block">
<div class="line">epoch 2:</div>
<div class="line">avg_loss = 0.9</div>
<div class="line">best_loss = 0.9</div>
<div class="line">checkpoint = ./output/model_epoch=1_metricValue=0.9.pt</div>
</div>
<div class="line-block">
<div class="line">epoch 3</div>
<div class="line">avg_loss = 1.1</div>
<div class="line">early_stop.counter += 1</div>
</div>
<div class="line-block">
<div class="line">epoch 4</div>
<div class="line">avg_loss = 1.2</div>
<div class="line">early_stop.counter += 1</div>
<div class="line">early_stop.patience == early_stop.counter</div>
<div class="line">training ends here</div>
</div>
</div>
</section>
<section id="hyperparameter-sweeps">
<h2>Hyperparameter sweeps<a class="headerlink" href="#hyperparameter-sweeps" title="Link to this heading">¶</a></h2>
<p>Use <a class="reference external" href="https://hydra.cc">hydra</a> to implement an easy search strategy for your hyper-parameters as follows:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Checkout the toy example in <a class="reference external" href="https://github.com/kornia/tutorials/tree/master/scripts/training/image_classifier">here</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">./</span><span class="n">train</span><span class="o">/</span><span class="n">image_classifier</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">num_epochs</span><span class="o">=</span><span class="mi">50</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">./</span><span class="n">train</span><span class="o">/</span><span class="n">image_classifier</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">multirun</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-4</span>
</pre></div>
</div>
</section>
<section id="distributed-training">
<h2>Distributed Training<a class="headerlink" href="#distributed-training" title="Link to this heading">¶</a></h2>
<p>Kornia <a class="reference internal" href="../x.html#kornia.x.Trainer" title="kornia.x.Trainer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trainer</span></code></a> heavily relies on <a class="reference external" href="https://github.com/huggingface/accelerate/">accelerate</a> to
decouple the process of running your training scripts in a distributed environment.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We haven’t tested yet all the possibilities for distributed training.
Expect some adventures or <a class="reference external" href="https://join.slack.com/t/kornia/shared_invite/zt-csobk21g-2AQRi~X9Uu6PLMuUZdvfjA">join us</a> and help to iterate :)</p>
</div>
<p>The below recipes are taken from the <cite>accelerate</cite> library in <a class="reference external" href="https://github.com/huggingface/accelerate/tree/main/examples#simple-vision-example">here</a>:</p>
<ul>
<li><p>single CPU:</p>
<ul>
<li><p>from a server without GPU</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>./train/image_classifier/main.py
</pre></div>
</div>
</li>
<li><p>from any server by passing <cite>cpu=True</cite> to the <cite>Accelerator</cite>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data<span class="w"> </span>--cpu
</pre></div>
</div>
</li>
<li><p>from any server with Accelerate launcher</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>launch<span class="w"> </span>--cpu<span class="w"> </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>single GPU:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>./train/image_classifier/main.py<span class="w">  </span><span class="c1"># from a server with a GPU</span>
</pre></div>
</div>
</li>
<li><p>with fp16 (mixed-precision)</p>
<ul>
<li><p>from any server by passing <cite>fp16=True</cite> to the <cite>Accelerator</cite>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data<span class="w"> </span>--fp16
</pre></div>
</div>
</li>
<li><p>from any server with Accelerate launcher</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>launch<span class="w"> </span>--fp16<span class="w"> </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>multi GPUs (using PyTorch distributed mode)</p>
<ul>
<li><p>With Accelerate config and launcher</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>config<span class="w">  </span><span class="c1"># This will create a config file on your server</span>
accelerate<span class="w"> </span>launch<span class="w"> </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data<span class="w">  </span><span class="c1"># This will run the script on your server</span>
</pre></div>
</div>
</li>
<li><p>With traditional PyTorch launcher</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>torch.distributed.launch<span class="w"> </span>--nproc_per_node<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use_env<span class="w"> </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>multi GPUs, multi node (several machines, using PyTorch distributed mode)</p>
<ul>
<li><p>With Accelerate config and launcher, on each machine:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>config<span class="w">  </span><span class="c1"># This will create a config file on each server</span>
accelerate<span class="w"> </span>launch<span class="w"> </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data<span class="w">  </span><span class="c1"># This will run the script on each server</span>
</pre></div>
</div>
</li>
<li><p>With PyTorch launcher only</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>torch.distributed.launch<span class="w"> </span>--nproc_per_node<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--use_env<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--node_rank<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--master_addr<span class="w"> </span>master_node_ip_address<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data<span class="w">  </span><span class="c1"># On the first server</span>

python<span class="w"> </span>-m<span class="w"> </span>torch.distributed.launch<span class="w"> </span>--nproc_per_node<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--use_env<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--node_rank<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--master_addr<span class="w"> </span>master_node_ip_address<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data<span class="w">  </span><span class="c1"># On the second server</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>(multi) TPUs</p>
<ul>
<li><p>With Accelerate config and launcher</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>accelerate<span class="w"> </span>config<span class="w">  </span><span class="c1"># This will create a config file on your TPU server</span>
accelerate<span class="w"> </span>launch<span class="w"> </span>./train/image_classifier/main.py<span class="w"> </span>--data_path<span class="w"> </span>path_to_data<span class="w">  </span><span class="c1"># This will run the script on each server</span>
</pre></div>
</div>
</li>
<li><p>In PyTorch:
Add an <cite>xmp.spawn</cite> line in your script as you usually do.</p></li>
</ul>
</li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="governance.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Kornia AI Organization</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="multi-framework-support.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Multi-Framework Support</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Kornia developers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Training API (experimental)</a><ul>
<li><a class="reference internal" href="#why-a-training-api">Why a Training API ?</a></li>
<li><a class="reference internal" href="#design-principles">Design Principles</a></li>
<li><a class="reference internal" href="#trainer-usage">Trainer Usage</a></li>
<li><a class="reference internal" href="#customize-callbacks">Customize [callbacks]</a></li>
<li><a class="reference internal" href="#preprocess-and-augmentations">Preprocess and augmentations</a></li>
<li><a class="reference internal" href="#callbacks-utilities">Callbacks utilities</a></li>
<li><a class="reference internal" href="#hyperparameter-sweeps">Hyperparameter sweeps</a></li>
<li><a class="reference internal" href="#distributed-training">Distributed Training</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=cce5339e"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/js/custom.js?v=107dad88"></script>
    <script defer="defer" type="module" src="https://gradio.s3-us-west-2.amazonaws.com/4.38.1/gradio.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.2/iframeResizer.min.js"></script>
    </body>
</html>