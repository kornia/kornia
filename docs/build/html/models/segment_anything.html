<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YSCFZB2WDV"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            
            gtag('config', 'G-YSCFZB2WDV');
            
        </script>
    <link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Faster Segment Anything (MobileSAM)" href="mobile_sam.html" /><link rel="prev" title="Real-Time Detection Transformer (RT-DETR)" href="rt_detr.html" />
        <link rel="canonical" href="https://kornia.readthedocs.io/models/segment_anything.html" />

    <link rel="shortcut icon" href="../_static/kornia_logo_favicon.png"/><!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Segment Anything (SAM) - Kornia</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/css/main.css?v=9b880210" />
    
    


<style>
  body {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  --color-sidebar-background: #3980F5;
  --color-sidebar-background-border: #3980F5;
  --color-sidebar-caption-text: white;
  --color-sidebar-link-text--top-level: white;
  --color-sidebar-link-text: white;
  --sidebar-caption-font-size: normal;
  --color-sidebar-item-background--hover:  #5dade2;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-sidebar-background: #1a1c1e;
  --color-sidebar-background-border: #1a1c1e;
  --color-sidebar-caption-text: white;
  --color-sidebar-link-text--top-level: white;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-sidebar-background: #1a1c1e;
  --color-sidebar-background-border: #1a1c1e;
  --color-sidebar-caption-text: white;
  --color-sidebar-link-text--top-level: white;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Kornia</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/img/kornia_logo_only_light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/img/kornia_logo_only_dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">GET STARTED</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get-started/introduction.html">What is Kornia library ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started/highlights.html">Highlighted Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started/about.html">About</a></li>
<li class="toctree-l1"><a class="reference external" href="https://kornia.github.io/tutorials/">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started/multi-framework-support.html">Multi-Framework Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started/training.html">Training API (experimental)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.luxonis.com/en/latest/pages/tutorials/creating-custom-nn-models/#kornia">OpenCV AI Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started/governance.html">Kornia AI Organization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API REFERENCE</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../augmentation.html">kornia.augmentation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of kornia.augmentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../augmentation.auto.html">Automatic Augmentation Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../augmentation.base.html">Base Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../augmentation.container.html">Augmentation Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../augmentation.module.html">Image Augmentations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../color.html">kornia.color</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contrib.html">kornia.contrib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.html">kornia.core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enhance.html">kornia.enhance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature.html">Local Features and Image Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">kornia.filters</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../geometry.html">kornia.geometry</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of kornia.geometry</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../geometry.bbox.html">kornia.geometry.bbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.boxes.html">kornia.geometry.boxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.keypoints.html">kornia.geometry.keypoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.calibration.html">kornia.geometry.calibration</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../geometry.camera.html">kornia.geometry.camera</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of kornia.geometry.camera</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometry.camera.pinhole.html">Pinhole Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry.camera.perspective.html">Perspective Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry.camera.stereo.html">Stereo Camera</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.conversions.html">kornia.geometry.conversions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.depth.html">kornia.geometry.depth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.epipolar.html">kornia.geometry.epipolar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.homography.html">kornia.geometry.homography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.liegroup.html">kornia.geometry.liegroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.liegroup.html#lie-algebra">lie algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.liegroup.html#lie-group-and-lie-algebra">lie group and lie algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.linalg.html">kornia.geometry.linalg</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.line.html">kornia.geometry.line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.quaternion.html">kornia.geometry.quaternion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.solvers.html">kornia.geometry.solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.subpix.html">kornia.geometry.subpix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.transform.html">kornia.geometry.transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry.ransac.html">kornia.geometry.ransac</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../sensors.html">kornia.sensors</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of kornia.sensors</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../sensors.camera.html">kornia.sensors.camera</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../io.html">kornia.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../image.html">kornia.image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../losses.html">kornia.losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Models Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics.html">kornia.metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../morphology.html">kornia.morphology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nerf.html">kornia.nerf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onnx.html">ONNXSequential: Chain Multiple ONNX Models with Ease</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tracking.html">kornia.tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">kornia.testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">kornia.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../x.html">kornia.x</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KORNIA APPLICATIONS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../applications/intro.html">Computer Vision Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/visual_prompting.html">Visual Prompting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/face_detection.html">Face Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_augmentations.html">Image Augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_classification.html">Image Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_matching.html">Image Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_stitching.html">Image Stitching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_registration.html">Image Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/image_denoising.html">Image Denoising</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/semantic_segmentation.html">Semantic segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/object_detection.html">Object detection</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KORNIA MODELS</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="efficient_vit.html">EfficientViT</a></li>
<li class="toctree-l1"><a class="reference internal" href="rt_detr.html">Real-Time Detection Transformer (RT-DETR)</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Segment Anything (SAM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobile_sam.html">Faster Segment Anything (MobileSAM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="yunet.html">YuNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="vit.html">Vision Transformer (ViT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vit_mobile.html">MobileViT</a></li>
<li class="toctree-l1"><a class="reference internal" href="tiny_vit.html">TinyViT</a></li>
<li class="toctree-l1"><a class="reference internal" href="loftr.html">LoFTR (matching)</a></li>
<li class="toctree-l1"><a class="reference internal" href="defmo.html">DeFMO (video)</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardnet.html">Hardnet (descriptor)</a></li>
<li class="toctree-l1"><a class="reference internal" href="affnet.html">Affnet (detection)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sold2.html">SOLD2 (Line detection and matching)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dexined.html">Dexined (edge detection)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SUPPORT</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/kornia/kornia/issues">Issue tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://join.slack.com/t/kornia/shared_invite/zt-csobk21g-2AQRi~X9Uu6PLMuUZdvfjA">Slack community</a></li>
<li class="toctree-l1"><a class="reference external" href="https://librecv.org">LibreCV community</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twitter.com/kornia_foss">Twitter @kornia_foss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/chinese.html">Kornia 社区</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.youtube.com/channel/UCI1SE1Ij2Fast5BSKxoa7Ag">Kornia Youtube</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.linkedin.com/company/kornia/">Kornia LinkedIn</a></li>
<li class="toctree-l1"><a class="reference external" href="https://kornia.org">Kornia AI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">COMMUNITY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/contribute.html">Contribute to Kornia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/faqs.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/bibliography.html">Bibliography</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/models/segment_anything.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="segment-anything-sam">
<h1>Segment Anything (SAM)<a class="headerlink" href="#segment-anything-sam" title="Link to this heading">¶</a></h1>
<p>The Segment Anything Model (SAM) produces high quality object masks from input prompts such as points or boxes, and it
can be used to generate masks for all objects in an image.</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><strong>Segment Anything</strong></p>
</div>
<div class="sd-card-body docutils">
<p class="sd-card-text"><strong>Abstract:</strong> We introduce the Segment Anything (SAM) project: a new task, model, and dataset for image
segmentation. Using our efficient model in a data collection loop, we built the largest segmentation
dataset to date (by far), with over 1 billion masks on 11M licensed and privacy respecting images. The
model is designed and trained to be promptable, so it can transfer zero-shot to new image distributions
and tasks. We evaluate its capabilities on numerous tasks and find that its zero-shot performance is impressive
– often competitive with or even superior to prior fully supervised results. We are releasing the Segment Anything
Model (SAM) and corresponding dataset (SA-1B) of 1B masks and 11M images at <a class="reference external" href="https://segment-anything.com">https://segment-anything.com</a> to foster
research into foundation models for computer vision.</p>
<p class="sd-card-text"><strong>Tasks:</strong> Segmentation</p>
<p class="sd-card-text"><strong>Datasets:</strong> SA-1B</p>
<p class="sd-card-text"><strong>Licence:</strong> Apache</p>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text"><strong>Authors:</strong> Alexander Kirillov and Eric Mintun and Nikhila Ravi and Hanzi Mao and Chloe Rolland and Laura
Gustafson and Alex Berg and Wan-Yen Lo and Piotr Dollar and Ross Girshick</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference external" href="https://segment-anything.com/"><span>https://segment-anything.com/</span></a></div>
<section id="how-to-use-sam-from-kornia">
<h2>How to use SAM from Kornia<a class="headerlink" href="#how-to-use-sam-from-kornia" title="Link to this heading">¶</a></h2>
<p>The Kornia API for SAM try to provide a simple API to access initialize the model and load/download the weights. Also,
providing it to a high-level API called <code class="code docutils literal notranslate"><span class="pre">VisualPrompter</span></code>, which allow the users to set an image and run multiple
queries multiple times.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">VisualPrompter</span></code> works querying on a single image, if you want to explore and query into a batch of images,
you can use the <code class="code docutils literal notranslate"><span class="pre">Sam</span></code> directly. But, for it you will need to write the boilerplate to preprocess and postprocess to
use it. This boilerplate, is already handle on the high-level API <code class="code docutils literal notranslate"><span class="pre">VisualPrompter</span></code>.</p>
<section id="visual-prompter">
<h3>Visual Prompter<a class="headerlink" href="#visual-prompter" title="Link to this heading">¶</a></h3>
<p id="anchor-prompter">The High level API <code class="code docutils literal notranslate"><span class="pre">VisualPrompter</span></code> handle with the image and prompt transformation, preprocessing and prediction for
a given SAM model.</p>
<p>About the <code class="code docutils literal notranslate"><span class="pre">VisualPrompter</span></code>:</p>
<ol class="arabic">
<li><p>From a <cite>ModelConfig</cite> loads the desired model with the desired checkpoint to be used as the model to receive the query
prompts. For know we just support Segment Anything model, where the <em>SAM-h</em> is the default option.</p></li>
<li><p>Based on the model, the <code class="code docutils literal notranslate"><span class="pre">VisualPrompter</span></code> will handle with the necessary transformations to be done into the image
and prompts before apply it to the model. These transformations are done using PyTorch backed, by our API of
augmentations. Where we use the <code class="xref py py-class docutils literal notranslate"><span class="pre">kornia.geometry.augmentation.AugmentationSequential</span></code> to handle with the different
data formats (keypoints, boxes, masks, image).</p></li>
<li><p>When you use <code class="code docutils literal notranslate"><span class="pre">prompter.set_image(...)</span></code>, the prompter will preprocess this image, then pass it to the encoder,
and cache the embeddings to query it after. Note that the image should be scaled within the range [0,1].</p>
<blockquote>
<div><ul class="simple">
<li><p>The preprocess steps are: 1) Resize the image to have its longer side the same size as <code class="code docutils literal notranslate"><span class="pre">image_encoder</span></code> image size
input. 2) Cache the information of this transformation to apply into the prompts. 3) normalize the image based on the
passed mean and standard deviation, or with the values of the SAM dataset. 4) pad on the bottom and right for the image
have the encoder expected resolution: <span class="math notranslate nohighlight">\((\text{image_encoder.img_size}, \text{image_encoder.img_size})\)</span>.</p></li>
<li><p>The best image to be used will always have the shape equals to
<span class="math notranslate nohighlight">\((\text{image_encoder.img_size}, \text{image_encoder.img_size})\)</span>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>When you use <code class="code docutils literal notranslate"><span class="pre">prompter.predict(...)</span></code>, the prompter will apply the cached transformations on the coordinates of the
prompts, and then query this prompts into the cached embeddings.</p>
<blockquote>
<div><ul class="simple">
<li><p>If <code class="code docutils literal notranslate"><span class="pre">output_original_size=True</span></code>, the results structure will upsample the logits from it’s resolution into the
image input original resolution. The output logits has the height and width equals to 256.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>You can benefit from using the <code class="code docutils literal notranslate"><span class="pre">torch.compile(...)</span></code> API (dynamo) for torch &gt;= 2.0.0 version. To compile with dynamo
we provide the method <code class="code docutils literal notranslate"><span class="pre">prompter.compile(...)</span></code> which will optimize the right parts of the backend model and the
prompter itself.</p></li>
</ol>
<hr class="docutils" />
<p>Example of using the <code class="code docutils literal notranslate"><span class="pre">VisualPrompter</span></code>:</p>
<p>Exploring how to simple initialize the <code class="code docutils literal notranslate"><span class="pre">VisualPrompter</span></code>, automatically load the weights from a URL,
read the image and set it to be query, how to write the prompts, and the multiple ways we can use these prompts
to query the image masks from the SAM model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.contrib.models.sam</span><span class="w"> </span><span class="kn">import</span> <span class="n">SamConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.contrib.visual_prompter</span><span class="w"> </span><span class="kn">import</span> <span class="n">VisualPrompter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_image</span><span class="p">,</span> <span class="n">ImageLoadType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.geometry.keypoints</span><span class="w"> </span><span class="kn">import</span> <span class="n">Keypoints</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.geometry.boxes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Boxes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_cuda_or_mps_device_if_available</span>

<span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;vit_h&#39;</span>
<span class="n">checkpoint</span> <span class="o">=</span> <span class="s1">&#39;./https://dl.fbaipublicfiles.com/segment_anything/sam_vit_h_4b8939.pth&#39;</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">get_cuda_or_mps_device_if_available</span>

<span class="c1"># Load image</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">load_image</span><span class="p">(</span><span class="s1">&#39;./example.jpg&#39;</span><span class="p">,</span> <span class="n">ImageLoadType</span><span class="o">.</span><span class="n">RGB32</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>

<span class="c1"># Define the model config</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">SamConfig</span><span class="p">(</span><span class="n">model_type</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">)</span>

<span class="c1"># Load the prompter</span>
<span class="n">prompter</span> <span class="o">=</span> <span class="n">VisualPrompter</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># You can use torch dynamo/compile API with:</span>
<span class="c1"># prompter.compile()</span>

<span class="c1"># set the image: This will preprocess the image and already generate the embeddings of it</span>
<span class="n">prompter</span><span class="o">.</span><span class="n">set_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="c1"># Generate the prompts</span>
<span class="n">keypoints</span> <span class="o">=</span> <span class="n">Keypoints</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">375</span><span class="p">]]],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span> <span class="c1"># BxNx2</span>
<span class="c1"># For the keypoints label: 1 indicates a foreground point; 0 indicates a background point</span>
<span class="n">keypoints_labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span> <span class="c1"># BxN</span>
<span class="n">boxes</span> <span class="o">=</span> <span class="n">Boxes</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[[</span><span class="mi">425</span><span class="p">,</span> <span class="mi">600</span><span class="p">],</span> <span class="p">[</span><span class="mi">425</span><span class="p">,</span> <span class="mi">875</span><span class="p">],</span> <span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">600</span><span class="p">],</span> <span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">875</span><span class="p">]]]],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;xyxy&#39;</span>
<span class="p">)</span>

<span class="c1"># Runs the prediction with all prompts</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">prompter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">keypoints</span><span class="o">=</span><span class="n">keypoints</span><span class="p">,</span>
    <span class="n">keypoints_labels</span><span class="o">=</span><span class="n">keypoints_labels</span><span class="p">,</span>
    <span class="n">boxes</span><span class="o">=</span><span class="n">boxes</span><span class="p">,</span>
    <span class="n">multimask_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">#----------------------------------------------</span>
<span class="c1"># or run the prediction with just the keypoints</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">prompter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">keypoints</span><span class="o">=</span><span class="n">keypoints</span><span class="p">,</span>
    <span class="n">keypoints_labels</span><span class="o">=</span><span class="n">keypoints_labels</span><span class="p">,</span>
    <span class="n">multimask_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">#----------------------------------------------</span>
<span class="c1"># or run the prediction with just the box</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">prompter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">boxes</span><span class="o">=</span><span class="n">boxes</span><span class="p">,</span>
    <span class="n">multimask_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">#----------------------------------------------</span>
<span class="c1"># or run the prediction without prompts</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">prompter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">multimask_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">#------------------------------------------------</span>
<span class="c1"># or run the prediction using the previous logits</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">prompter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">masks</span><span class="o">=</span><span class="n">prediction</span><span class="o">.</span><span class="n">logits</span>
    <span class="n">multimask_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># The `prediction` is a SegmentationResults dataclass with the masks, scores and logits</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">masks</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">scores</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">logits</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p>Read more about the <code class="code docutils literal notranslate"><span class="pre">SegmentationResults</span></code> on <a class="reference internal" href="../contrib.html#anchor-segmentationresults"><span class="std std-ref">the official docs</span></a></p>
</section>
<section id="load-from-config">
<h3>Load from config<a class="headerlink" href="#load-from-config" title="Link to this heading">¶</a></h3>
<p>You can build a SAM model by specifying the encoder parameters on the <code class="code docutils literal notranslate"><span class="pre">SamConfig</span></code>, or from the model type. The
<code class="code docutils literal notranslate"><span class="pre">from_config</span></code> method will first try to build the model based on the model type, otherwise will try from the specified
parameters. If a checkpoint URL or path for a file is seted, the method will automatically load it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">kornia.contrib.models.sam</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sam</span><span class="p">,</span> <span class="n">SamConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_cuda_or_mps_device_if_available</span>

<span class="c1"># model_type can be:</span>
<span class="c1">#   0, &#39;vit_h&#39; or `kornia.contrib.models.sam.SamModelType.vit_h`</span>
<span class="c1">#   1, &#39;vit_l&#39; or `kornia.contrib.models.sam.SamModelType.vit_l`</span>
<span class="c1">#   2, &#39;vit_b&#39; or `kornia.contrib.models.sam.SamModelType.vit_b`</span>
<span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;vit_b&#39;</span>

<span class="c1"># The checkpoint can be a filepath or a url</span>
<span class="n">checkpoint</span> <span class="o">=</span> <span class="s1">&#39;./path_for_the_model_checkpoint.pth&#39;</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">get_cuda_or_mps_device_if_available</span><span class="p">()</span>

<span class="c1"># Load config</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">SamConfig</span><span class="p">(</span><span class="n">model_type</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">)</span>

<span class="c1"># Load the model with checkpoint</span>
<span class="n">sam_model</span> <span class="o">=</span> <span class="n">Sam</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Move to desired device</span>
<span class="n">sam_model</span> <span class="o">=</span> <span class="n">sam_model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-checkpoint">
<h3>Load checkpoint<a class="headerlink" href="#load-checkpoint" title="Link to this heading">¶</a></h3>
<p>With the load checkpoint method you can load from a file or directly from a URL. The official (by meta) model weights are:</p>
<ol class="arabic simple">
<li><p><cite>vit_h</cite>: <a class="reference external" href="https://dl.fbaipublicfiles.com/segment_anything/sam_vit_h_4b8939.pth">ViT-H SAM model - https://dl.fbaipublicfiles.com/segment_anything/sam_vit_h_4b8939.pth</a>.</p></li>
<li><p><cite>vit_l</cite>: <a class="reference external" href="https://dl.fbaipublicfiles.com/segment_anything/sam_vit_l_0b3195.pth">ViT-L SAM model - https://dl.fbaipublicfiles.com/segment_anything/sam_vit_l_0b3195.pth</a>.</p></li>
<li><p><cite>vit_b</cite>: <a class="reference external" href="https://dl.fbaipublicfiles.com/segment_anything/sam_vit_b_01ec64.pth">ViT-B SAM model - https://dl.fbaipublicfiles.com/segment_anything/sam_vit_b_01ec64.pth</a>.</p></li>
</ol>
<p>If a URL is passed the model will automatically download and cache the weights using
<code class="code docutils literal notranslate"><span class="pre">torch.hub.load_state_dict_from_url</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">kornia.contrib.models.sam</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sam</span><span class="p">,</span> <span class="n">SamConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_cuda_or_mps_device_if_available</span>

<span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;vit_b&#39;</span>

<span class="c1"># The checkpoint can be a filepath or a url</span>
<span class="n">checkpoint</span> <span class="o">=</span> <span class="s1">&#39;./path_for_the_model_checkpoint.pth&#39;</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">get_cuda_or_mps_device_if_available</span><span class="p">()</span>

<span class="c1"># Load/build the model</span>
<span class="n">sam_model</span> <span class="o">=</span> <span class="n">Sam</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">SamConfig</span><span class="p">(</span><span class="n">model_type</span><span class="p">))</span>

<span class="c1"># Load the checkpoint</span>
<span class="n">sam_model</span><span class="o">.</span><span class="n">load_checkpoint</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="example-of-how-to-use-the-sam-model-without-api">
<h3>Example of how to use the SAM model without API<a class="headerlink" href="#example-of-how-to-use-the-sam-model-without-api" title="Link to this heading">¶</a></h3>
<p>This is a simple example, of how to directly use the SAM model loaded. We recommend the use of
<a class="reference internal" href="#anchor-prompter"><span class="std std-ref">Prompter API</span></a> to handle/prepare the inputs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">kornia.contrib.models.sam</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sam</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.contrib.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">SegmentationResults</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_image</span><span class="p">,</span> <span class="n">ImageLoadType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_cuda_or_mps_device_if_available</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">resize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">kornia.enhance</span><span class="w"> </span><span class="kn">import</span> <span class="n">normalize</span>

<span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;vit_b&#39;</span> <span class="c1"># or can be a number `2` or the enum sam.SamModelType.vit_b</span>
<span class="n">checkpoint_path</span> <span class="o">=</span> <span class="s1">&#39;./path_for_the_model_checkpoint.pth&#39;</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">get_cuda_or_mps_device_if_available</span><span class="p">()</span>

<span class="c1"># Load the model</span>
<span class="n">sam_model</span> <span class="o">=</span> <span class="n">Sam</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_type</span><span class="p">,</span> <span class="n">checkpoint_path</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>

<span class="c1"># Load image</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">load_image</span><span class="p">(</span><span class="s1">&#39;./example.jpg&#39;</span><span class="p">,</span> <span class="n">ImageLoadType</span><span class="o">.</span><span class="n">RGB32</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>

<span class="c1"># Transform the image (CxHxW) into a batched input (BxCxHxW)</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

<span class="c1"># Resize the image to have the maximum size 1024 on its largest side</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;long&#39;</span><span class="p">)</span>

<span class="c1"># Embed prompts -- ATTENTION: should match the coordinates after the resize of the image</span>
<span class="n">sparse_embeddings</span><span class="p">,</span> <span class="n">dense_embeddings</span> <span class="o">=</span> <span class="n">sam_model</span><span class="o">.</span><span class="n">prompt_encoder</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boxes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">masks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># define the info for normalize the input</span>
<span class="n">pixel_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">pixel_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Preprocess input</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pixel_mean</span><span class="p">,</span> <span class="n">pixel_std</span><span class="p">)</span>
<span class="n">padh</span> <span class="o">=</span> <span class="n">model_sam</span><span class="o">.</span><span class="n">image_encoder</span><span class="o">.</span><span class="n">img_size</span> <span class="o">-</span> <span class="n">h</span>
<span class="n">padw</span> <span class="o">=</span> <span class="n">model_sam</span><span class="o">.</span><span class="n">image_encoder</span><span class="o">.</span><span class="n">img_size</span> <span class="o">-</span> <span class="n">w</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">padw</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">padh</span><span class="p">))</span>

<span class="c1">#--------------------------------------------------------------------</span>
<span class="c1"># Option A: Manually calling each API</span>
<span class="c1">#--------------------------------------------------------------------</span>
<span class="n">low_res_logits</span><span class="p">,</span> <span class="n">iou_predictions</span> <span class="o">=</span> <span class="n">sam_model</span><span class="o">.</span><span class="n">mask_decoder</span><span class="p">(</span>
    <span class="n">image_embeddings</span><span class="o">=</span><span class="n">sam_model</span><span class="o">.</span><span class="n">image_encoder</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
    <span class="n">image_pe</span><span class="o">=</span><span class="n">sam_model</span><span class="o">.</span><span class="n">prompt_encoder</span><span class="o">.</span><span class="n">get_dense_pe</span><span class="p">(),</span>
    <span class="n">sparse_prompt_embeddings</span><span class="o">=</span><span class="n">sparse_embeddings</span><span class="p">,</span>
    <span class="n">dense_prompt_embeddings</span><span class="o">=</span><span class="n">dense_embeddings</span><span class="p">,</span>
    <span class="n">multimask_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">SegmentationResults</span><span class="p">(</span><span class="n">low_res_logits</span><span class="p">,</span> <span class="n">iou_predictions</span><span class="p">)</span>

<span class="c1">#--------------------------------------------------------------------</span>
<span class="c1"># Option B: Calling the model itself</span>
<span class="c1">#--------------------------------------------------------------------</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">sam_model</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="p">[{}],</span> <span class="n">multimask_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#--------------------------------------------------------------------</span>
<span class="c1"># Post processing</span>
<span class="c1">#--------------------------------------------------------------------</span>
<span class="c1"># Upscale the masks to the original image resolution</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">original_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">image_size_encoder</span> <span class="o">=</span> <span class="p">(</span><span class="n">model_sam</span><span class="o">.</span><span class="n">image_encoder</span><span class="o">.</span><span class="n">img_size</span><span class="p">,</span> <span class="n">model_sam</span><span class="o">.</span><span class="n">image_encoder</span><span class="o">.</span><span class="n">img_size</span><span class="p">)</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">original_res_logits</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">original_size</span><span class="p">,</span> <span class="n">image_size_encoder</span><span class="p">)</span>

<span class="c1"># If wants to check the binary masks</span>
<span class="n">masks</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">binary_masks</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="mobile_sam.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Faster Segment Anything (MobileSAM)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="rt_detr.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Real-Time Detection Transformer (RT-DETR)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Kornia developers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Segment Anything (SAM)</a><ul>
<li><a class="reference internal" href="#how-to-use-sam-from-kornia">How to use SAM from Kornia</a><ul>
<li><a class="reference internal" href="#visual-prompter">Visual Prompter</a></li>
<li><a class="reference internal" href="#load-from-config">Load from config</a></li>
<li><a class="reference internal" href="#load-checkpoint">Load checkpoint</a></li>
<li><a class="reference internal" href="#example-of-how-to-use-the-sam-model-without-api">Example of how to use the SAM model without API</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=cce5339e"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/custom.js?v=107dad88"></script>
    <script defer="defer" type="module" src="https://gradio.s3-us-west-2.amazonaws.com/4.38.1/gradio.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.2/iframeResizer.min.js"></script>
    </body>
</html>